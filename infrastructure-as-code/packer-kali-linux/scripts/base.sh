#!/bin/bash

# Script config
ROOT_PW='RootChangeMe!'
ROOT_SSH=''
OTTO_PW='OttoChangeMe!'
OTTO_SSH=''

# Initial configuration for Root
mkdir -p /root/.ssh/
echo root:$ROOT_PW | /usr/sbin/chpasswd
echo $ROOT_SSH >> /root/.ssh/authorized_keys

# Initial configuration for Otto
mkdir -p /home/otto/.ssh/
useradd -d /home/otto otto
chown otto:otto /home/otto/
chown otto:otto /home/otto/.ssh
echo otto:$OTTO_PW | /usr/sbin/chpasswd
echo "otto ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/otto
echo $OTTO_SSH >> /home/otto/.ssh/authorized_keys

# System config
apt-get -y -qq update

# OpenSSH Config
mkdir /etc/ssh/old_keys
mv /etc/ssh/ssh_host_* /etc/ssh/old_keys
dpkg-reconfigure openssh-server
sed -i 's/PermitRootLogin\ yes/PermitRootLogin\ without-password/g' /etc/ssh/sshd_config
